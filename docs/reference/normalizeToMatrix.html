<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Normalize Associations between Genomic Signals and Target Regions into a Matrix — normalizeToMatrix • EnrichedHeatmap</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Normalize Associations between Genomic Signals and Target Regions into a Matrix — normalizeToMatrix" />
<meta property="og:description" content="Normalize Associations between Genomic Signals and Target Regions into a Matrix" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EnrichedHeatmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.15.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/EnrichedHeatmap.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/roadmap.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/row_odering.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/visualize_categorical_signals_wrapper.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jokergoo/EnrichedHeatmap">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalize Associations between Genomic Signals and Target Regions into a Matrix</h1>
    
    <div class="hidden name"><code>normalizeToMatrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Normalize Associations between Genomic Signals and Target Regions into a Matrix</p>
    </div>

    <pre class="usage"><span class='fu'>normalizeToMatrix</span>(<span class='no'>signal</span>, <span class='no'>target</span>, <span class='kw'>extend</span> <span class='kw'>=</span> <span class='fl'>5000</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>extend</span>)/<span class='fl'>50</span>,
    <span class='kw'>value_column</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>mapping_column</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>background</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='no'>smooth</span>, <span class='fl'>NA</span>, <span class='fl'>0</span>), <span class='kw'>empty_value</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
    <span class='kw'>mean_mode</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"absolute"</span>, <span class='st'>"weighted"</span>, <span class='st'>"w0"</span>, <span class='st'>"coverage"</span>), <span class='kw'>include_target</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span>(<span class='fu'>width</span>(<span class='no'>target</span>) <span class='kw'>&gt;</span> <span class='fl'>1</span>),
    <span class='kw'>target_ratio</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.4</span>, <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='fu'>width</span>(<span class='no'>target</span>))/(<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>extend</span>) + <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='fu'>width</span>(<span class='no'>target</span>))))),
    <span class='kw'>k</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>20</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='fu'>width</span>(<span class='no'>target</span>)))), <span class='kw'>smooth</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>smooth_fun</span> <span class='kw'>=</span> <span class='no'>default_smooth_fun</span>,
    <span class='kw'>keep</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>), <span class='kw'>trim</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>flip_upstream</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>signal</th>
      <td><p>A <code><a href='https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html'>GRanges-class</a></code> object.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>A <code><a href='https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html'>GRanges-class</a></code> object.</p></td>
    </tr>
    <tr>
      <th>extend</th>
      <td><p>Extended base pairs to the upstream and/or downstream of <code>target</code>. It can be a vector of length one or two. Length one means same extension to the upstream and downstream.</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>Window size for splitting upstream and downstream, measured in base pairs</p></td>
    </tr>
    <tr>
      <th>value_column</th>
      <td><p>Column index in <code>signal</code> that is mapped to colors. If it is not set, it assumes values for all signal regions are 1.</p></td>
    </tr>
    <tr>
      <th>mapping_column</th>
      <td><p>Mapping column to restrict overlapping between <code>signal</code> and <code>target</code>. By default it tries to look for all regions in <code>signal</code> that overlap with every target.</p></td>
    </tr>
    <tr>
      <th>background</th>
      <td><p>Values for windows that don't overlap with <code>signal</code>.</p></td>
    </tr>
    <tr>
      <th>empty_value</th>
      <td><p>Deprecated, please use <code>background</code> instead.</p></td>
    </tr>
    <tr>
      <th>mean_mode</th>
      <td><p>When a window is not perfectly overlapped to <code>signal</code>, how to summarize  values to the window. See 'Details' section for a detailed explanation.</p></td>
    </tr>
    <tr>
      <th>include_target</th>
      <td><p>Whether include <code>target</code> in the heatmap? If the width of all regions in <code>target</code> is 1, <code>include_target</code> is enforced to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>target_ratio</th>
      <td><p>The ratio of <code>target</code> columns in the normalized matrix. If the value is 1, <code>extend</code> will be reset to 0.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>Number of windows only when <code>target_ratio = 1</code> or <code>extend == 0</code>, otherwise ignored.</p></td>
    </tr>
    <tr>
      <th>smooth</th>
      <td><p>Whether apply smoothing on rows in the matrix?</p></td>
    </tr>
    <tr>
      <th>smooth_fun</th>
      <td><p>The smoothing function that is applied to each row in the matrix. This self-defined function accepts a numeric vector (may contain <code>NA</code> values) and returns a vector with same length. If the smoothing is failed, the function should call <code><a href='https://rdrr.io/r/base/stop.html'>stop</a></code> to throw errors so that <code>normalizeToMatrix</code> can catch how many rows are failed in smoothing.  See the default <code>default_smooth_fun</code> for example.</p></td>
    </tr>
    <tr>
      <th>keep</th>
      <td><p>Percentiles in the normalized matrix to keep. The value is a vector of two percent values. Values less than the first percentile is replaces with the first pencentile and values larger than the second percentile is replaced with the second percentile.</p></td>
    </tr>
    <tr>
      <th>trim</th>
      <td><p>Deprecated, please use <code>keep</code> instead.</p></td>
    </tr>
    <tr>
      <th>flip_upstream</th>
      <td><p>Sometimes whether the signals are on the upstream or the downstream of the targets are not important and users only want to show the relative distance to targets. If the value is set to <code>TRUE</code>, the upstream part in the normalized matrix is flipped and added to the downstream part The flipping is only allowed when the targets are single-point targets or the targets are excluded in the normalized matrix (by setting <code>include_target = FALSE</code>). If the extension for the upstream and downstream is not equal, the smaller extension is used for the final matrix.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>In order to visualize associations between <code>signal</code> and <code>target</code>, the data is transformed into a matrix
and visualized as a heatmap by <code>EnrichedHeatmap</code> afterwards.</p>
<p>Upstream and downstream also with the target body are splitted into a list of small windows and overlap
to <code>signal</code>. Since regions in <code>signal</code> and small windows do not always 100 percent overlap, there are four different averaging modes:</p>
<p>Following illustrates different settings for <code>mean_mode</code> (note there is one signal region overlapping with other signals):</p>
<p></p><pre>
      40      50     20     values in signal regions
    ++++++   +++    +++++   signal regions
           30               values in signal region
         ++++++             signal region
      =================     a window (17bp), there are 4bp not overlapping to any signal regions.
        4  6  3      3      overlap

    absolute: (40 + 30 + 50 + 20)/4
    weighted: (40*4 + 30*6 + 50*3 + 20*3)/(4 + 6 + 3 + 3)
    w0:       (40*4 + 30*6 + 50*3 + 20*3)/(4 + 6 + 3 + 3 + 4)
    coverage: (40*4 + 30*6 + 50*3 + 20*3)/17  </pre>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix with following additional attributes:</p>
<dl class='dl-horizontal'>
  <dt><code>upstream_index</code></dt><dd><p>column index corresponding to upstream of <code>target</code></p></dd>
  <dt><code>target_index</code></dt><dd><p>column index corresponding to <code>target</code></p></dd>
  <dt><code>downstream_index</code></dt><dd><p>column index corresponding to downstream of <code>target</code></p></dd>
  <dt><code>extend</code></dt><dd><p>extension on upstream and downstream</p></dd>
  <dt><code>smooth</code></dt><dd><p>whether smoothing was applied on the matrix</p></dd>
  <dt><code>failed_rows</code></dt><dd><p>index of rows which are failed after smoothing</p></dd>

</dl>

<p>The matrix is wrapped into a simple <code>normalizeToMatrix</code> class.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>signal</span> <span class='kw'>=</span> <span class='fu'>GRanges</span>(<span class='kw'>seqnames</span> <span class='kw'>=</span> <span class='st'>"chr1"</span>,
    <span class='kw'>ranges</span> <span class='kw'>=</span> <span class='fu'>IRanges</span>(<span class='kw'>start</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>4</span>, <span class='fl'>7</span>, <span class='fl'>11</span>, <span class='fl'>14</span>, <span class='fl'>17</span>, <span class='fl'>21</span>, <span class='fl'>24</span>, <span class='fl'>27</span>),
                     <span class='kw'>end</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>, <span class='fl'>5</span>, <span class='fl'>8</span>, <span class='fl'>12</span>, <span class='fl'>15</span>, <span class='fl'>18</span>, <span class='fl'>22</span>, <span class='fl'>25</span>, <span class='fl'>28</span>)),
    <span class='kw'>score</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>))
<span class='no'>target</span> <span class='kw'>=</span> <span class='fu'>GRanges</span>(<span class='kw'>seqnames</span> <span class='kw'>=</span> <span class='st'>"chr1"</span>, <span class='kw'>ranges</span> <span class='kw'>=</span> <span class='fu'>IRanges</span>(<span class='kw'>start</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>end</span> <span class='kw'>=</span> <span class='fl'>20</span>))
<span class='fu'>normalizeToMatrix</span>(<span class='no'>signal</span>, <span class='no'>target</span>, <span class='kw'>extend</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='fl'>2</span>)</div><div class='output co'>#&gt; Normalize signal to target:
#&gt;   Upstream 10 bp (5 windows)
#&gt;   Downstream 10 bp (5 windows)
#&gt;   Include target regions (6 windows)
#&gt;   1 target region</div><div class='input'><span class='fu'>normalizeToMatrix</span>(<span class='no'>signal</span>, <span class='no'>target</span>, <span class='kw'>extend</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>include_target</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; Normalize signal to target:
#&gt;   Upstream 10 bp (5 windows)
#&gt;   Downstream 10 bp (5 windows)
#&gt;   Include target regions (6 windows)
#&gt;   1 target region</div><div class='input'><span class='fu'>normalizeToMatrix</span>(<span class='no'>signal</span>, <span class='no'>target</span>, <span class='kw'>extend</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>value_column</span> <span class='kw'>=</span> <span class='st'>"score"</span>)</div><div class='output co'>#&gt; Normalize signal to target:
#&gt;   Upstream 10 bp (5 windows)
#&gt;   Downstream 10 bp (5 windows)
#&gt;   Include target regions (6 windows)
#&gt;   1 target region</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Zuguang Gu &lt;z.gu@dkfz.de&gt;</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


